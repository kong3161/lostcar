<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏£‡∏ñ‡∏´‡∏≤‡∏¢</title>
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom right, #b31217, #6a0572);
      color: white;
    }
    #map {
      height: 60vh;
      width: 100%;
    }
    h2 {
      text-align: center;
      padding: 1rem;
    }
    .btn-group {
      text-align: center;
      margin: 1rem 0;
    }
    .btn {
      background: white;
      color: black;
      padding: 8px 16px;
      border-radius: 6px;
      text-decoration: none;
      margin: 5px;
      display: inline-block;
    }
  </style>
</head>
<body>
  <h2>üìç ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏∏‡∏î‡∏£‡∏ñ‡∏´‡∏≤‡∏¢</h2>
  <form method="get" action="/map" style="text-align:center; margin: 1rem;">
    <label for="from_date">‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
    <input type="date" name="from_date" id="from_date" required>
    <label for="to_date">‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
    <input type="date" name="to_date" id="to_date" required>
    <button type="submit">üîç ‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô</button>
  </form>
  <div id="map"></div>
  <div class="btn-group">
    <a class="btn" href="/">üìã ‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏ñ‡∏´‡∏≤‡∏¢</a>
    <a class="btn" href="/search">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</a>
    <a class="btn" href="/dashboard">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
    <a class="btn" href="/map" style="background: #ddd; font-weight: bold;">üó∫Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a>
  </div>

  <script>
    function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 14,
        center: { lat: 13.987004, lng: 100.614520 },
      });

      const reports = {{ reports | tojson }};
      console.log("Reports loaded:", reports);

      for (const item of reports) {
        const lat = parseFloat(item.lat);
        const lng = parseFloat(item.lng);

        if (!isNaN(lat) && !isNaN(lng) && lat !== 0 && lng !== 0) {
          const marker = new google.maps.Marker({
            position: { lat, lng },
            map,
            title: `${item.brand || ''} ${item.model || ''}`
          });

          const infoContent = `
            <div style="color:black">
              <strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ:</strong> ${item.vehicle_type || '-'}<br>
              <strong>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠:</strong> ${item.brand || '-'}<br>
              <strong>‡∏£‡∏∏‡πà‡∏ô:</strong> ${item.model || '-'}<br>
              <strong>‡∏™‡∏µ:</strong> ${item.color || '-'}<br>
              <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢:</strong> ${item.date_lost || '-'}<br>
            </div>
          `;

          const infoWindow = new google.maps.InfoWindow({
            content: infoContent
          });

          marker.addListener("click", () => {
            infoWindow.open(map, marker);
          });
        }
      }
    }
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap">
  </script>
</body>
</html>